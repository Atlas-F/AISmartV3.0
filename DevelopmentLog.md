# Development Logs



```

格式标准：
**2025-7-27 V3.0.4**
- Idea
- 功能实现
- 已知问题
- 故障排除
- FAQ
- 改进总结
	

```



## 格式 ##

**2025-7-27 V3.0.4**

- Idea
- 功能实现
- 已知问题
- 故障排除

- FAQ
- 改进总结





------



- **2025.6.13 V1.0.1**

  - 休眠界面表情图间隔一秒随机切换

- **2025.6.14 V1.0.2**

  - 手势滑动切换屏幕，左滑或者右滑
  - 向下滑动切换时间显示
  - 在第二屏设置模拟AI与人类对话，显示文本 ，使用文本文档模拟对话内容

- **2025.6.15 V1.0.3**

  - 点击humanpanel，更新文本内容，humanpanel和AIPanel轮流显示对话文本，模拟对话
  - ubuntu可以正常模拟，开发板不行

- **2025.6.16 V1.0.4**

  - 在ubuntu上面可以实现调用Deepseek，进行英文文本格式的输入与输出对话，但是逻辑顺序需要修正，循环的逻辑无法人为控制，应该在输出之后等待输入完成在进行下一次分析与输出

- **2025.6.17 V1.0.5**

  - 修正了deepseek对话逻辑，获取完整输入，在inputlogo按键回调函数内部即创建会话，长按唤出键盘与输入框，点击提交输入内容。通过全局变量沟通LVGL和deepseek会话
  - 使用辅助函数获取完整文本框内容

- **2025.6.20 V1.0.6**

  - 开发板上安装openssl链接curl库，否则不支持https协议，curl库与openssl配置版本匹配要求较高，先配置交叉编译openssl库（三步走：./configure  --  make -- make install），再配置curl库。
  - SSL证书问题待解决

- **2025.7.5 V2.0.1**

  - SSL证书
  - 在新虚拟机Ubuntu-24.04或者WSL上复原AISmartV1.0
    - 似乎有超时段错误，
    - 如何使用物理键盘输入？

  - 测试网络
  - 构思项目具体实现

- **2025-7-6 V2.0.1**
  更新：
      - 修复之前的段错误问题
          原因：内存布局原先存在潜在问题，使得在处理输入input时，get_full_text函数可能会导致input长度溢出越界，并侵入到session的内存区域
          但是目前并不能完全肯定是该原因，还进行了其他的测试，只是该方法下目前在暂未出问题。
          还需要对get_full_text函数进行优化
          - 调用api-key 似乎也有潜在问题
              - 拟添加中文输入法功能，但是存在段错误以及渲染设备的权限问题，
                可能原因：中文输入法的复杂渲染使得原本的权限问题升级，但是甚至已经开了3d加速图形。
                若是是需要使用中文输入法，还需要进一步的调试
              - 拟设置api key到环境变量中，避免硬编码
              - 在编写程序时注意进行边界检查，输入检查，异常检查，压力测试。增强健壮性。

     - github 提交存在问题，由于重新安装了WSL，并且开发文件目录变更，提交出现问题

- **2025-7-7 V2.0.2**

  - 不适用API KEY 硬编码的方式，而是使用别的方法，增强安全
    - 使用环境配置key，但是会出现段错误
  - 输入缓冲区有溢出风险

- **2025-7-8 V2.0.3**

  - 使用环境变量加载api key。
  - 加载天气功能，定位
  - 架构构思：
    - 将所有的自定义代码放在项目根目录下，置于一个源文件中，并编写头文件，在进行项目导出时，只需加入一个头文件即可快速将项目恢复到上衣状态
  - 项目中的无用资源较多，挤压有效资源空间，需要清理，会在编译过程中出现错误，
    - ![](C:\Users\phoen\Pictures\7ee3e257-eb72-46dd-9f90-0d9a44e75c5d.png)
    - 这种情况下，先使用make clean ，再进行make，可临时解决问题
  - 增加多轮对话，联系上下文。
    - 将消息内容添加到一个数组中， 再进行拼接成一个完整的字符串，每次进行拼接前先要重置
    - 增大输出缓冲区

- **2025-7-11 V2.0.3** 补丁

  - 输入时，第一次点击输不进去
  - 需要对cjson进行检查
  - 

- **2025-7-12 V2.0.4**

  - 天气功能，根据API的响应对地址和相应的天气情况显示对应的UI
    - 显示UI图片，依靠子部件的顺序排列，从API响应获取的code即是对应天气图片在容器内的序号 ，依靠序号定位，所以不能打乱

- **2025-7-13 V2.0.5**

  - 多轮对话与联系上下文：
    - 基本实现，目前主要是错误处理与内存管理不完善
      - 错误处理：timeout 错误时的资源管理等，要释放资源。避免下次请求导致的二次释放
      - 内存管理：有些全局变量资源没有正确释放，虽然不会引起错误，但是会导致内存泄漏

- **2025-7-21 V3.0.1**

  - 大改动，使用C++进行重构，抽象接口层，降低耦合，增强扩展性
    - 使用meyers单例重构deepseek会话和curl的管curl_global_initt，确保全局唯一
    - 使用类存储记录deepseek相关变量和操作：*DPSKSession会话结构体*、*DeepSeek对话Curl初始化*、*deepseek请求体构建*、*deepseek 响应解析，纯解析类*。
    - deepseek网络对话部分类基本完成重构，暂未进行逻辑测试。

- **2025-7-25 V3.0.2**

  - 实现天气获取、时间显示、DeepSeek多轮对话

- **2025-7-26 V3.0.3**

  - 预计实现：动画类
  - 实现动画类。滑动、淡入淡出、弹跳等。。。

- **2025-7-27 V3.0.4**
  - Idea
    - 摄像头调用
    - 本地规则引擎，与小型AI模型，实现命令执行的本地代理人角色，即有一个模组可以执行输入的命令。规则匹配和执行组件，（通过执行预先设置好的“条件-动作”规则）来达到近似于本地执行助手的效果。初期使用规则引擎，后续可扩展至使用引擎+AI模型来实现更强大与复杂的指令实现
    - 将视觉识别引入，引入AI进行数据分析等执行动作
  - 功能实现：
    - [x] 摄像头调用测试实现
  - 已知问题
  - 故障排除
  
  - FAQ
  - 改进总结
  
- **2025-7-28 V3.0.4**
  
  - Idea：
  - - 核心引擎避免使用Qt类型
    - 适配器模式
    - 实现一个类似于命令行的操作界面：AI要可以通过命令打开和关闭，还是要深入优化规则引擎与命令系统。
    - 要将输入和输出摘出来，不能绑定控件：使用规则匹配打开，然后只=使用信号槽的方式进行打开关闭
    - 输入完成后按enter即可自动发送给和清空输入框
    - 进程间通信，信号槽的方式吗？
    - 数据互通，：什么格式？信息头怎么写？
    - 如何打开程序内部的独立模块？命令系统需要再添加一种命令执行方式？传递什么参数？
    - 对于各种创建修改文件的路径如何设置？
    - 设置副屏打印各种输出信息
    - 使用QProcess打开的程序，算这个QT程序的进程还是主机的进程？还是两者都算？
    - 使用QProcess::startDetached打开的程序，该方式独立于程序，与程序无通信，无法使用相对函数关闭，可以通过pid关闭
    - 将openapplication中的map设置为全局或者设置为类属公有或者私有变量，进行解耦
    - 将时间日期天气等信息设置在工具栏，类似于表头
    - 打开的程序要记录，通过这个表来进行操作，打开或者关闭，在打开程序时，将该程序pid传进去绑定。使用重载版本的start函数  打开，可以传递pid。
    - 目前可以打开，但是无法关闭？
  
  - 功能实现
  
    规则引擎
  
    进程和线程的中和调度操作
  
  - 已知问题：
  
  - - 多重定义函数，因为编译时编译文件中有遗留的重名文件，删除即可
  
  - 故障排除
  
  - - 多重定义函数，因为编译时编译文件中有遗留的重名文件，删除即可
  
  - FAQ
  
  - - 打开应用时，为什么有的应用可以在桌面显示（例如：浏览器），有的不行（例如：记事本）？
  
    - - 换一种打开方式，startdetached 打开独立进程，因为阻塞
  
    - 映射表之外的与应用可以打开，但是似乎不会显式弹出？
  
    - 使用QDesktopServices::openUrl 和 QProcess::start 启动程序要注意些什么？如何正确启动？
  
    - 原先版本不会单独开新窗口运行程序，使用startdetached 可以单独打开新窗口运行程序
  
    - 正反斜杠有区别
  
    - 能否写一个脚本获取电脑上所有程序的完整可执行路径
  
  - 知识点：
  
  - - lambda表达式
    - 核心代码
    - connect函数的重载，并不一定需要4个参数
    - 在类外初始化 static 成员时**不能添加** **static** **关键字**
    - 规则引擎的核心需求，“硬编码的条件判断无法适应规则的扩展性”
    - command 列表的标准用法是：
  
  [程序完整路径, 参数1, 参数2, ...]
  
  - command[0] = 程序路径（核心，必须正确）；
  - 后续元素 = 程序的命令行参数（按需添加，格式由程序决定）。
  
  - 若省略路径（如直接写 notepad），系统会在 PATH 环境变量指定的目录中查找程序，适合系统自带工具（如 notepad、calc），但跨平台兼容性差。
  
  QProcess::startDetached(appName, {}, QDir::homePath());
  
  与start的使用方法区别？
  
  - 改进总结
  
  - - 规则引擎通过 **“正则表达式提取共性 + Lambda 封装个性”**：模式匹配
    - 该方法目前似乎无法实现复杂命令，只能匹配单一命令。如：打开 xxx。等，无法实现多个命令，例如打开后的更具体的操作，不过，这个复杂操作似乎没必要，交给用户决定。
    - 正则表达式中的 “捕获” 和 Lambda 表达式中的 “捕获” 是两个完全不同的概念，分别用于解决不同场景的问题，核心区别在于：**正则捕获针对 “文本内容提取”，Lambda 捕获针对 “外部变量访问”：**正则捕获解决 “从文本中拿什么”，Lambda 捕获解决 “拿到后交给谁处理”。
    - 规则不够完善，：没有打开文件等
    - 如何实现根据不同的文件类型，打开文件提取内容？
  
  注意：
  
  在 Qt 中使用 QProcess 启动外部程序时，你提到的几种方式是否合法，取决于**系统是否能识别程序名称或路径**，具体场景和合法性如下：
  
  ### **1. 完整路径 + 参数（最推荐，兼容性最好）****格式****：****["/full/path/to/program.exe", "param1", "param2"]**
  
  **示例**：["C:/Windows/notepad.exe", "D:/test.txt"]
  
  - **合法性**：完全合法，且是最可靠的方式。
  - **原理**：通过完整绝对路径直接定位可执行文件，不依赖系统环境，跨平台（Windows/Linux/macOS）通用。
  - **适用场景**：所有程序，尤其是非系统自带的第三方软件（如 Chrome、自定义程序）。
  
  ### **2. 程序名称 + 参数（依赖系统环境，有条件合法）****格式****：****["programName", "param1", "param2"]**
  
  **示例**：["notepad", "test.txt"]（Windows 记事本）、["gedit", "notes.txt"]（Linux 文本编辑器）
  
  - **合法性**：仅当程序所在目录在系统 PATH 环境变量中时合法。
  
  - **原理**：系统会在 PATH 包含的目录中自动查找与 programName 匹配的可执行文件。
  
  - **限制**：
  
  - - 仅适用于系统自带程序（如 notepad、calc、ls）或已添加到 PATH 的程序。
    - 跨平台兼容性差（例如 notepad 在 Linux 上不存在）。
  
  ### **3. 程序名称 + 完整路径（通常不推荐，可能无效）****格式****：****["programName", "/full/path/to/target"]**
  
  **示例**：["notepad", "C:/Windows/notepad.exe"]
  
  - **合法性**：多数情况下无意义，甚至会报错。
  - **原理**：此时 programName 是要启动的程序，而后面的 “完整路径” 会被当作**该程序的参数**，而非程序本身的路径。
  - **问题**：例如 ["notepad", "C:/xxx.exe"] 会被解析为 “用记事本打开 C:/xxx.exe 这个文件”，而不是 “启动 C:/xxx.exe 程序”。
  
  ### **总结**
  
  - **合法且推荐**：完整路径 + 参数（通用、可靠）。
  - **合法但有限制**：程序名称 + 参数（仅适用于系统 PATH 中的程序）。
  - **不推荐且可能无效**：程序名称 + 完整路径（容易产生逻辑错误）。
  
  实际开发中，**优先使用 “完整路径 + 参数”**，可避免因环境差异导致的启动失败问题。如果需要简化写法（如系统命令），可使用 “程序名称 + 参数”，但需确保程序在 PATH 中。





- **2025-7-29 V3.0.4**

  - Idea

  - 功能实现
    - 规则引擎：
      - 关闭规则实现
    - 规则引擎打开程序内deepseek

  - 已知问题

  - 故障排除


  - FAQ

  - 改进总结
  - 知识点
